# AWS 강의

## IAM

JSON 형식으로 작성. 작성되지 않은 내용은 모두 차단된다. 

### IAM 정책

#### 권한 경계

IAM 사용자 또는 역할에 최대 권한을 제한. 

### IAM 역할

AWS리소스에서 사용하는 자격증명. 정책을 연결해서 IAM역할에 작업 수행에 필요한 권한을 부여

#### 신뢰정책

>  IAM 역할을 사용하여 AWS 계정간 접근 권한 위임을 하는 기능. 

특정 AWS 서비스가 다른 AWS 서비스에 접근할 때 사용하는 기능. 예를 들면, 개발서버와 운영서버가 있을 때, 일시적으로 운영서버에 대한 코드 푸시 권한을 개발 계정을 가진 사용자에게 부여해야 한다고 하자. 이 때 사용할 수 있는 솔루션은 운영계정에 IAM역할을 생성한 다음, 개발 계정에 신뢰정책을 정의하면 된다.

#### IAM 역할 예제

IAM > 역할 > 필요한 서비스 선택

EC2에서 실행되는 앱이 RDS, S3와 같은 다른 서비스에 접근하려고 할 때 EC2에 정책을 추가한 IAM 권한을 주면 된다.

##### EC2에 IAM 추가 방법

인스턴스 생성 시, 고급 프로파일에 들어가서 IAM 인스턴스 프로파일에 생성한 IAM 역할을 추가해주면 된다.



### IAM 보안 도구

##### IAM 자격증명 보고서

생성된 계정과 관련한 패스워드, 엑세스 키 등의 정보를 볼 수 있다.

##### IAM 엑세스 관리자

서비스 별로 어떤 접근 권한을 가지고 있는지 알 수 있다.



#### IAM 정책 시뮬레이터

> AWS 계정의 IAM 사용자, 사용자 그룹 또는 역할에 연결된 정책을 테스트

어떤 IAM A(계정, 역할, RULE-정책)가 B action 권한을 가지고 있는지 확인 가능하다. 예를 들면 A 계정이 이미지 생성 action을 할 수 있는지와 같은 확인을 할 수 있다. 



## EC2

>  클라우드 컴퓨팅 서비스.

리소스. 인스턴스, 로드밸런서, 배치그룹 등이 있다. 태그를 추가할 수 있다. 애플리케이션 이미지가 있다. 인스턴스 유형을 선택할 수 있다. 키페어로 원격접속 시 사용가능한 키 파일 등을 생성할 수 있다. 네트워크 설정을 할 수 있다. 보안 그룹을 선택할 수 있다. 보안 그룹을 통해 접근 규칙 등을 선택할 수 있다. 스토리지 구성을 이용해 가상 컴퓨터가 사용할 스토리지를 선택할 수 있다. 공유파일을 위한 파일 시스템도 선택할 수 있다.

- 사용자 데이터

인스턴스를 실행할 때, 여기에 스크립트가 있으면 해당 스크립트를 실행함.

### 연결방식

#### 1. SSH

키 파일을 이용해 커맨드 프롬프트를 이용해 접근이 가능하다. 22번 포트로 접속하기 때문에 22번 포트 방화벽 오픈이 필요하다.

키파일이 너무 많은 로컬 사용자에게 오픈되어 있는 경우 접근이 차단될 수 있다.

=> 파일 속성에 상속사용안함 선택하고 현재사용자만 추가해주자.

#### 2. RDP (Windows only)

원도우즈 OS의 RDP 프로토콜을 이용한다. 접속할 때 암호는 EC2 콘솔에서 키파일을 이용해 암호를 생성할 수 있다.

인스턴스 > 인스턴스 ID선택 > 인스턴스에 연결 선택 >

\> RDP 클라이언트 > 암호가져오기 선택해서 키파일 데이터 업로드하면 암호화 키 생성할 수 있음.

#### 3. Instance Connect

리눅스만 가능. Ec2 `연결` 선택하면 된다. 

원격 연결 불가시 리눅스 > 보안 > 22번 포트 오픈인지 확인

### 인스턴스 유형

인스턴스 유형에 따라 컴퓨터 하드웨어가 결정. CPU, 메모리, 스토리지, 네트워크 용량의 여러 조합으로 구성. 컴퓨터 스펙을 선택한다고 보면 된다. 

### 네트워크 인터페이스

`ENI` 가상 네트웨크 인터페이스. 인스턴스에 가상 IP, MAC 주소를 준다. 

인스턴스 > 네트워킹 tab. 보안그룹관 연결이 됨. 서브넷은 인스턴스와 동일한 가용영역에 있어여 함. 하나의 인스턴스에 2개 이상의 네트워크 인터페이스를 줄 수 있다.

### 보안그룹

EC2 인스턴스에 대한 인바운드 아웃바운드 트래픽을 제어하는 가상 방화벽 역할을 한다. 인스턴스의 네트워크 인터페이스와 연결됨. `상태저장 방화벽`이다. 허용 규칙만 지정 가능하고 거부 규칙은 지정할 수 없음. 

#### 상태저장 방화벽

아웃바운드 규칙 상관 없이 허용된 인바운드 트래픽에 대한 반응으로 외부로 나가는 흐름이 수행. 내가 이해한 바로는 정당한 인바운드 요청에 대해 아웃바운드 트래픽(예_http 응답)은 허용된다. 마찬가지로 아웃바운드 요청이 EC2에서 먼저 발생했다면 그에 맞는 응답은 인바운드 요청 관계없이 허용된다. 

### 탄력적 IP

인스턴스를 생성할 때 할당받은 public IP는 인스턴스를 재시작하면 다른 IP로 할당 받아 주소가 변경된다. Elastic IP를 할당 받으면 인스턴스를 다시 시작해도 고정 IP를 받아서 쓸 수 있다. 탄력적 IP는 유료 서비스이다.

### AMI

> 아마존 머신 이미지. 

3가지 종류가 있다. 아마존에서 제공하는 기본 이미지, 마켓플레이스, 사용자 커스텀 AMI가 있다. elastic block store에서 스냅샷을 만들어서 내가 만들어둔 이미지를 저장할 수 있다.  

### 배치그룹

인스턴스를 물리적으로 어디에 배치할지. 

#### 클러스터 배치그룹

인접한 물리적 서버끼리 배치해서 네트워크 지연시간이 매우 짧아서(**고속 네트워크 연결**) 고성능 컴퓨팅에 적합하다.

#### 파티션 배치그룹

하드웨어를 파티션을 그룹화. 파티션끼리는 서로 다른 하드웨어 사용. 하드웨어를 공유하지 않기 때문에 하나의 하드웨어 장애 발생 시 다른 하드웨어에 영향 없음.  하둡 등의 빅데이터 분산처리 시스템에 활용. 

#### 분산형 배치 그룹

같은 서버랙의 서버를 그룹화. 서버랙 단위로 장애가 발생했을 때 영향도 없음. 매우 중요하고 고가용성이 필요한 애플리케이션에 적합.

### EC2 라이프 사이클

시작: 인스턴스 전원을 켜는 것

재부팅 : 인스턴스 재부팅

중지 : 인스턴스 전월을 끄는 것

종료 : 인스턴스 삭제

`최대절전모드` : RAM에 있는 애플리케이션 상태를 저장 후 중지상태 전환 노트북에서 종료를 안하고 스크린만 닫을 때와 동일. 서버 부팅 시 프로세스 로드시간이 오래걸리는 시스템의 경우 유용.



## Elastic Load Balancing

### 확장성

- 수직적 확장 : 자원을 추가하는 방식 (사양 업그레이드)

- 수평적 확장 :  노드를 추가하는 방식. EC2 인스턴스 개수를 늘리는 것.

고가용성 : 이중화를 통해 가용영역 하나에 장애가 발생해도 가용성 유지 가능

### 로드밸런서

애플리케이션, 네트워크, 게이트웨이 로드밸런서

#### 애플리케이션 

7계층에서 사용

#### 네트워크 

4계층에서 사용

#### 게이트웨이

 

















